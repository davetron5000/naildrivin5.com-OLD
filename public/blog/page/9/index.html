
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Naildrivin' &#10106;</title>
  <meta name="author" content="David Bryant Copeland">

  
  <meta name="description" content="Object-Oriented design is hard, especially in a large application. It&#8217;s not always clear where logic should go, and there&#8217;s often no &# &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.naildrivin5.com/blog/page/9/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Naildrivin' &#10106;" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-10518541-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <meta name="google-site-verification" content="h_yTpXa6N3ebHj8DYmgX4lIFGHBW1NtGMVHfXuu7i_4" />
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Naildrivin' &#10106;</a></h1>
  
    <h2>&#10144; Website of David Bryant Copeland</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.naildrivin5.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="http://www.theseniorsoftwareengineer.com">My New Book!</a></li>
  <li><a href="/scalatour">Scala Tour</a></li>
  <li><a href="/talks">Talks</a></li>
  <li><a href="/blog/archives">Blog Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/03/08/object-oriented-design.html">The Only Four Types of Classes in Your OO System</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-03-08T00:00:00-05:00" pubdate data-updated="true">Mar 8<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
Object-Oriented design is hard, especially in a large application.  It&#8217;s not always clear where logic should go, and there&#8217;s often no &#8220;right place&#8221; to  put a piece of code.  I&#8217;ve found that there are four distinct types of classes that, if you stick to them, can make your code a lot more understandable, and can provide clear direction as to the age-old question of &#8220;where does this code go?&#8221;
</p>
<p>
<h2>0. Background</h2>
The J2EE way is to have model objects be stupid structs, and have all business logic in a service layer (this is actually very close to a classic &#8220;functional programming&#8221; way of doing things; ironic that many Java devs eschew FP).  Spring lets you do whatever you want, but more or less follows this pattern.  
While the &#8220;Rails Way&#8221; is to put business logic on the model objects, I think the &#8220;service layer&#8221; concept <a href="http://www.engineyard.com/blog/2010/let-them-code-cake/">is eventually going to be common practice</a>.
So, I&#8217;ve found that I very rarely make a pure &#8220;by-the-book according-to-Hoyle&#8221; OO-compliant class; I&#8217;ve settled on four patterns that seem to cover pretty much everything.  I&#8217;ve also noticed that when these patterns get mixed together, you get trouble.
</p>
<p>
<h2>1. The Record</h2>
The <i>record</i> is a dumb struct that you usually need to appease your object-relational mapper.  You may need them elsewhere to just name and type some set of data that you either can&#8217;t model as a tuple because of your language, or don&#8217;t want to model as a tuple because of some complexity.  A record typically has methods that merely expose it&#8217;s contents and often need to be mutable for the reasons stated.  You might have derived fields that are convieniences and not based on your core business logic.  An easy example is a person.  They have a name and a birthdate, and you might derive their age from that:
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">Date</span> <span class="n">birthdate</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Date</span> <span class="n">birthdate</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">birthdate</span> <span class="o">=</span> <span class="n">birthdate</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">}</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span> <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getBirthdate</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">birthdate</span><span class="o">;</span> <span class="o">}</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBirthdate</span><span class="o">(</span><span class="n">Date</span> <span class="n">birthdate</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">birthdate</span> <span class="o">=</span> <span class="n">birthdate</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getAge</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">// I know this is slightly buggy :)</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">(</span>
</span><span class='line'>      <span class="k">new</span> <span class="nf">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">()</span>
</span><span class='line'>      <span class="o">-</span> <span class="n">getBirthdate</span><span class="o">().</span><span class="na">getTime</span><span class="o">()</span>
</span><span class='line'>      <span class="o">)</span> <span class="o">/</span> <span class="o">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">365</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="c1">// Maybe some toString, equals, etc. type stuff as well</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>
</p>
<p>
<h2>2. The Immutable Object</h2>
This is the closest to a pure &#8220;object-oriented&#8221; design.  Classes of this type are immutable and should hold data you will use a lot in your system.  They may also probably have some business-logic attached as methods; this business logic should be entirely focused on the object and its contents.  Typical methods will give you more complex information about the data the object contains, or will vend new objects of the same type, based on the method and parameters called.  
</p>
<p>
This is the most clear distinction (in my mind) between functional programming and object-oriented programming.  In an FP world, the data being operated on would be loosely defined (if at all) and you&#8217;d have functions that transform it.  In an OO world, your object&#8217;s data is clearly defined (by the class fields/accessors), and the operations available are the methods of the class.  When you require that the objects of the class be immutable, you have a very nice encapsulated package of data and operations.  This, to me, seems a lot easier to deal with than a &#8220;module&#8221; of functions and some tuples (or lists of tuples) that the functions operate on.  Scala makes it very easy to create classes like this.  It&#8217;s probably one of the few languages that does so (Java certainly is no help, but it <b>can</b> be done).
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Appointment</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Date</span> <span class="n">date</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">description</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">attendees</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="nf">Appointment</span><span class="o">(</span>
</span><span class='line'>      <span class="n">Date</span> <span class="n">date</span><span class="o">,</span>
</span><span class='line'>      <span class="n">String</span> <span class="n">description</span><span class="o">,</span>
</span><span class='line'>      <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">attendees</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">// normally, you would validate the inputs</span>
</span><span class='line'>    <span class="c1">// for sanity, e.g. Validate.notNull(date)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Since Date is mutable, we make a copy</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">date</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">(</span><span class="n">date</span><span class="o">.</span><span class="na">getTime</span><span class="o">());</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">;</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">attendees</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">unmodifiableCollection</span><span class="o">(</span><span class="n">attendees</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Date</span> <span class="nf">getDate</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">// Since Date is mutable, we vend a copy</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">date</span><span class="o">.</span><span class="na">getTime</span><span class="o">());</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMessage</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">message</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">People</span><span class="o">&gt;</span> <span class="n">getAttendees</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">attendees</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isLate</span><span class="o">(</span><span class="n">Date</span> <span class="n">otherDate</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">date</span><span class="o">.</span><span class="na">before</span><span class="o">(</span><span class="n">otherDate</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">shouldRemind</span><span class="o">(</span><span class="n">Date</span> <span class="n">otherDate</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">!</span><span class="n">isLate</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">otherDate</span><span class="o">.</span><span class="na">getTime</span><span class="o">()</span>
</span><span class='line'>      <span class="o">-</span> <span class="k">this</span><span class="o">.</span><span class="na">date</span><span class="o">.</span><span class="na">getTime</span><span class="o">())</span> <span class="o">&gt;=</span> <span class="o">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isAttending</span><span class="o">(</span><span class="n">Person</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">attendees</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Appointment</span> <span class="nf">reschedule</span><span class="o">(</span><span class="n">Date</span> <span class="n">newDate</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">new</span> <span class="nf">Appointment</span><span class="o">(</span><span class="n">newDate</span><span class="o">,</span><span class="n">getMessage</span><span class="o">(),</span><span class="n">getAttendees</span><span class="o">());</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Appointment</span> <span class="nf">notAttending</span><span class="o">(</span><span class="n">Person</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">isAttending</span><span class="o">(</span><span class="n">p</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">newGroup</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;(</span><span class="n">getAttendees</span><span class="o">());</span>
</span><span class='line'>      <span class="n">newGroup</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nf">Appointment</span><span class="o">(</span><span class="n">getDate</span><span class="o">(),</span><span class="n">getMessage</span><span class="o">(),</span><span class="n">newGroup</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>
</p>
<p>
The benefits here are huge; immutability allows your codebase to be much more comprehensible, and allows you to use these objects in concurrent situations without worry.  Since they are immutable, their methods are immediate targets for caching if you discover you need to do this to improve performance.
</p>
<p>
<h2>3. The Builder</h2>
While you can certainly use methods (or create methods) on Immutable Object classes to &#8220;build up&#8221; the object you want, this is often cumbersome, and results in a lot of object creation for no real reason.  The &#8220;builder&#8221; can be used to make this a bit simpler.  The Builder is a throwaway class whose sole purpose is to create Immutable Objects.  This obviously creates a very tight coupling between the two classes, but this can be worth it.  This is very preferable to a mutable class and, depending on your operating environment, is preferable to making many intermediate objects you will need to create the Immutable Object.
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppointmentBuilder</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">Date</span> <span class="n">date</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">String</span> <span class="n">description</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">people</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">AppointmentBuilder</span> <span class="nf">setDate</span><span class="o">(</span><span class="n">Date</span> <span class="n">date</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">date</span> <span class="o">=</span> <span class="n">date</span><span class="o">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">AppointmentBuilder</span> <span class="nf">setDescription</span><span class="o">(</span><span class="n">String</span> <span class="n">description</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">description</span> <span class="o">=</span> <span class="n">description</span><span class="o">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">AppointmentBuilder</span> <span class="nf">addPerson</span><span class="o">(</span><span class="n">Person</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">people</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Appointment</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">new</span> <span class="nf">Appointment</span><span class="o">(</span><span class="n">date</span><span class="o">,</span><span class="n">description</span><span class="o">,</span><span class="n">people</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>
</p>
<p>
<h2>4. The Service</h2>
The analog of The Record, the <i>service</i> has no data and all logic.  EJBs are services; they have no internal state, operating on their arguments and returning a result.  Methods of services can be very functional in nature (operating solely on structs or immutable objects), or they may provide functionality that implements complex business logic not logically part of an immutable object&#8217;s class.  In a vanilla n-tier application, you use services to get data in and out of your database (you might call these DAOs and you might distinguish different types of services for partitioning, but these are all the same sort of class).
</p>
<p>
Like records, Services are not OO at all; these are the functions to your C programs structs.  But, there is a good reason for this design; you separate concerns, don&#8217;t need to worry about concurrency (services have no state), and can even horizontally partition <i>where</i> serivces actually run.
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Calendaring</span> <span class="o">{</span>
</span><span class='line'>  <span class="cm">/** Schedule an appointment */</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Appointment</span> <span class="nf">schedule</span><span class="o">(</span>
</span><span class='line'>      <span class="n">Date</span> <span class="n">date</span><span class="o">,</span>
</span><span class='line'>      <span class="n">String</span> <span class="n">description</span><span class="o">,</span>
</span><span class='line'>      <span class="n">String</span><span class="o">...</span> <span class="n">names</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">AppointmentBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AppointmentBuilder</span><span class="o">(</span><span class="n">date</span><span class="o">)</span>
</span><span class='line'>      <span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="n">description</span><span class="o">);</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="nl">name:</span> <span class="n">names</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">Person</span> <span class="n">p</span> <span class="o">=</span> <span class="n">findPersonByName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span><span class='line'>       <span class="k">if</span> <span class="o">(</span><span class="n">p</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>         <span class="n">builder</span><span class="o">.</span><span class="na">addPerson</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
</span><span class='line'>       <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>
</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/01/26/reading-a-file-in-scala-ruby-java.html">Reading a File in Scala vs. Java vs Ruby</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-26T00:00:00-05:00" pubdate data-updated="true">Jan 26<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
Examining the code needed to read a file line by line is a a common way to examine the hoops a programming language makes you jump through.  While Perl certainly
has some one-liners for this, let&#8217;s start with Ruby, which presents an elegant and clear way of doing it:
<div>
  <pre>
    <code class='ruby'>File.open(&quot;some_file.txt&quot;) do |file|
  file.readlines.each do |line|
    puts line.upcase
  end
end</code>
  </pre>
</div>

It really doesn&#8217;t get any clearer than that.
</p>
<p>
Here&#8217;s the canonical Java way of doing it, complete with plenty of places to introduce bugs:
<div>
  <pre>
    <code class='java'>import java.io.*;

public class ReadFile {
  public static void main(String args[]) throws IOException {
    File file = new File(&quot;some_file.txt&quot;);
    BufferedReader reader = new BufferedReader(
      new FileReader(file));
    String line = reader.readLine();
    while (line != null) {
      System.out.println(line.toUpperCase());
      line = reader.readLine();
    }
    reader.close();
  }
}</code>
  </pre>
</div>

Yech.  The need to call <code>readLine()</code> twice kinda sucks.  We could use a do-while, but that requires a second <code>line != null</code> check.  Personally, I like to forget the second <code>readLine()</code> and wonder why my code runs forever :)  That being said, this was extremely easy to figure out, even the very first time I did it in 1998.  The class names are obvious, and the documentation is excellent.
</p>
<p>
Scala to the rescue, right?
<div>
  <pre>
    <code class='scala'>import scala.io._

object ReadFile extends Application {
  val s = Source.fromFile(&quot;some_file.txt&quot;)
  s.getLines.foreach( (line) =&gt; {
    println(line.trim.toUpperCase)
  })
}</code>
  </pre>
</div>

This was a slight pain figure out.  I looked in <code>scala.io</code> and, of the few classes that were there (including a curiously named <code>BytePickle</code>), it appeared as though <code>Source</code> was the class to use.  Of course, there&#8217;s no easy way to create one from the constructor, and the scaladoc doesn&#8217;t just say &#8220;Dude, look at the <code>Source</code> object&#8221;.  Once I looked through the <code>Source</code> object&#8217;s scaladoc, the solution presented itself.
</p>
<p>
Of course, unlike every other line-traversing library in the known universe, <code>Source</code> leaves the line endings on.  This is thankfully fixed in 2.8 (by which I mean 2.8 breaks 2.7&#8217;s implementation, which is a strange thing for a point release to do).  The real question is: &#8220;Is this how I&#8217;m supposed to read files in Scala?&#8221;.  With a class called <nobr><code>Source?!</code></nobr>.  The scaladoc says that this class represents &#8220;an iterable representation of source files&#8221;.  That might explain the strange methods like <code>reportError</code> and <code>reportWarning</code>.  I guess this is only for writing the Scala compiler?   If so, <code>scala.io</code> seems an odd place to put this.
</p>
<p>
So, my answer is &#8220;No, this <strong>cannot</strong> be how to canonically read files in Scala&#8221;.  Since the Java way kinda, well, sucks, what alternatives are there?  There&#8217;s <code><a href="http://scalax.scalaforge.org/api/">scalax.io</a></code>, which seems to implement this as a class called, curiously, <code>FileExtras</code>.    I&#8217;m not sure if this code is actively maintained, but it&#8217;s documented in classic Scala style: terse and full of loaded terms like &#8220;nonstrict&#8221;. Nevertheless, there seems to be some code here to easily read a file &#8220;the easy way&#8221; (despite some distracting names).
</p>
<p>
This points out a big difference between &#8220;Scala the language&#8221; and &#8220;Scala the library&#8221;.  Scala the language is very interesting and has a lot of potential.  Scala the library is schizophrenic at best; it&#8217;s not sure if it wants to be OO, functional, or what.  The documentation ranges from sparse to absent, and the overall designs of the classes and package range for sublime to baffling.  Years different from Java 1.1.
</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/01/24/unicode-domain-names.html">Unicode in Your Domain Names</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-24T00:00:00-05:00" pubdate data-updated="true">Jan 24<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
Got a few questions about how I set up <a href="http://&#10106;&#10144;.ws/">&#10106;&#10144;.ws</a> (which is powered
by <a href="http://www.github.com/davetron5000/shorty">Shorty</a>, my <a href="2009-11-23-good-bad-ugly-scala-url-shortener.html">Scala-based URL shortener</a>), so I thought I&#8217;d write up how I got it working.  Short answer is that it was pretty easy.
</p>
<p>
I got the idea from <a href="http://www.daringfireball.net">John Gruber</a>, who made a similar thing for his site to post entries on <a href="http://www.twitter.com/daringfireball">@daringfireball</a>.  The trickiest part was figuring out what this was called so I could find out who could sell me a domain with unicode characters in it.
</p>
<p>
It turns out, this is called an IDN (short for <a href="http://en.wikipedia.org/wiki/Internationalized_domain_name">Internationalized Domain Name</a>), and not everyone will sell you one.  Couple that with the need to get a non-<code>.com</code> domain, and I had to hunt around for a while.
</p>
<p>
I ended up going with <a href="http://www.dynadot.com/">DynaDot</a> as they could provide the wacky hostname that I wanted as well as a <code>.ws</code> TLD registration.  I was amazed at the number of domain regstrars whose web forms could not handle Unicode.
It&#8217;s been almost 7 years since <a href="http://www.joelonsoftware.com/articles/Unicode.html">Joel Spolsky</a> wrote his screed on dealing with Unicode, so I don&#8217;t know what the deal is.
</p>
<p>
At any rate, the tricky bit in actually <b>using</b> the domain, because a) entering &#10106;&#10144; into vim is nontrivial, and b) I doubt that Apache&#8217;s config file would work with unicode characters in it.  Enter <a href="http://en.wikipedia.org/wiki/Punycode">Punycode</a>, which is an asciification of any IDN.  Fortunately, the domain host provides the Punycode for your IDN, so configuring apache was a matter of:
<div>
  <pre>
    <code class='apache'>&lt;VirtualHost XXXXX&gt;
ServerName xn--dfi5d.ws
ServerAlias www.xn--dfi5d.ws
DocumentRoot /home/webadmin/xn--dfi5d.ws/html
&lt;!-- whatever else goes here --&gt;
JkMount /s* ajp13
JkMount /s ajp13
  &lt;Directory /home/webadmin/xn--dfi5d.ws/html&gt;
    Options Includes FollowSymLinks
    AllowOverride All
  &lt;/Directory&gt;
&lt;/VirtualHost&gt;</code>
  </pre>
</div>

</p>
<p>
At this point, it pretty much worked, although it was sometimes difficult to get curl to work with the non-punyied name.
</p>
<p>
One thing that was weird was that I found that a <b>lot</b> of domains I wanted to try were taken or not available (with no explanation).  Often it seemed like the punycode version was a normal looking URL that was taken; I tried several IDNs that had a unicode character with a wierd &#8220;5&#8221;, and they punyied to an ascii 5.  Not sure what the deal is there, but I eventually found the one I wanted.
</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/01/09/Top-5-Omissions-From-Spring-MVC.html">Top 5 Shocking Omissions From Spring MVC</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-09T00:00:00-05:00" pubdate data-updated="true">Jan 9<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
Been working with Spring MVC recently.  My enthusiasm has waned somewhat, as I&#8217;ve discovered that for all of it&#8217;s tweakability and configurableosity, it omits what I believe to be incredibly obvious things:
<ol>
  <li><strong>Simple, 80/20 conventions by default</strong> - While the phrase &#8220;convention over configuration&#8221; appears numerous times
  in the Spring documentation, it is <strong>still</strong> unable to call the <code>foo</code> method of the class
  <code>BarController</code> when I request the url <code>bar/foo</code> without a lot of configuration, some of which subtly conflicts
  and causes silent failures.   The default configuration is useless</li>
  <li><strong>Debugging the Routing</strong> - I shovel angle bracket after annotation after angle bracket into Spring and it simply <strong>can not</strong> tell me what
  URL patterns are mapped to where, and why a given URL isn&#8217;t mapped, nor what to do to get it mapped. It&#8217;s <strong>whole purpose is to map URLs to controllers</strong>.
  Shocking.</li>
  <li><strong>Simple internal routing without magic strings</strong> - If I&#8217;ve mapped <code>FooController</code>&#8217;s <code>bar</code>
  method, shouldn&#8217;t I be able to redirect/route to that in code via <code>route(FooController.class,"bar")</code>, regardless of the specific URL that
  <code>FooController</code> and <code>bar</code> respond to?  Instead, I&#8217;ve got magic strings everywhere and if my urls ever change, god help me.  And don&#8217;t get me 
  started about accessing this stuff via tests.</li>
  <li><strong>Simple web-testing</strong> - Adding a dependency on JWebUnit doesn&#8217;t cut it.  Jetty and Tomcat cannot hot deploy.  How do people test these things??!?!</li>
  <li><strong>Test Fixture Support</strong> - I had to hack this up with DBUnit.  With maven in the mix, it&#8217;s a huge hit to productivity, but at least I have it.  What project <strong>doesn&#8217;t</strong> need this??!?!</li>
</ol>
</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/24/scalas-map-literal-as-a-prezi.html">Prezi on Decoding the Scala Map Literal</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-24T00:00:00-05:00" pubdate data-updated="true">Nov 24<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p class="first">
If you haven&#8217;t checked out <a href="http://www.prezi.com">Prezi</a> as a means to create presentations, you really should.  They have rethought the entire
user experience, and it&#8217;s totally awesome.  To give you a flavor of it, I created a presentation of
my blog on <a href="/blog/2009/11/12/deconstructing-scala-map-literal.html">Deconstructing Scala&#8217;s Map Literal</a>.  I can&#8217;t create audio in the format
Prezi requires, so there&#8217;s no voice over, but I think it still works.
</p>
<p>
<object id="prezi_pj5_r8volng6" name="prezi_pj5_r8volng6" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="550" height="400"> <param name="movie" value="http://prezi.com/bin/preziloader.swf"/>  <param name="allowfullscreen" value="true"/>  <param name="allowscriptaccess" value="always"/>  <param name="bgcolor" value="#ffffff"/>  <param name="flashvars" value="prezi_id=pj5_r8volng6&amp;lock_to_path=1&amp;color=ffffff&amp;autoplay=no"/>  <embed id="preziEmbed_pj5_r8volng6" name="preziEmbed_pj5_r8volng6" src="http://prezi.com/bin/preziloader.swf" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="550" height="400" bgcolor="#ffffff" flashvars="prezi_id=pj5_r8volng6&amp;lock_to_path=1&amp;color=ffffff&amp;autoplay=no"> </embed> </object>
</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/23/good-bad-ugly-scala-url-shortener.html">Writing a URL Shortener in Scala - the Good, the Bad, the Ugly</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-23T00:00:00-05:00" pubdate data-updated="true">Nov 23<span>rd</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p class="first">
I finally got around to finishing <a href="http://www.github.com/davetron5000/shorty">Shorty</a>, my url-shortener for my vanity short-domain, 
<a href="http://&#10106;&#10144;.ws/">&#10106;&#10144;.ws</a>.  I did the whole thing in Scala as a way to create a fully-functining application
that I would use and that I could finish in my non-work time.  Scala unequivocally made this task enjoyable and quick.  J2EE, on the other hand, 
did not help one bit.
</p>
<p>
<h2>The Good</h2>
<h3>Scala</h3>
</p>
<p>
My Scala code is so much shorter and easier to follow than the Java equivalent.  Consider this code that, given
the request path, finds a controller to handle it, and then calls the appropriate method based upon
the HTTP method:
<div>
  <pre>
    <code class='scala'>route(path) match {
  case Some(controller) =&gt; {
    val result = determineMethod(request) match {
      case GET =&gt; controller.get(params(request))
      case PUT =&gt; controller.put(params(request))
      case POST =&gt; controller.post(params(request))
      case DELETE =&gt; controller.delete(params(request))
    }</code>
  </pre>
</div>

It&#8217;s highly readable, and very concise; the Java version would&#8217;ve required a lot more variables, some noisier control structures, and a lot more braces and parens.
</p>
<p>
<h3>ScalaTest</h3>
</p>
<p>
ScalaTest resulted in a lot more readable code than JUnit or TestNG would&#8217;ve.  Because of Scala&#8217;s syntax, the tests are also free of weird dots and &#8220;literate&#8221; syntax that
isn&#8217;t quite that literate.
<div>
  <pre>
    <code class='scala'>it (&quot;should respond to get for a URL that is known&quot;) {
  val controller = new OneUrlController(hasher,&quot;738ddf&quot;)
  val result = controller.get(Map())
  result.getClass should equal (classOf[URL])
  result.asInstanceOf[URL].url should equal 
    (&quot;http://www.google.com&quot;)
}</code>
  </pre>
</div>

The delineation between &#8220;expected&#8221; and &#8220;received&#8221; could not be more clear.  <tt>assertEquals</tt> just isn&#8217;t the same.
The latest version of ScalaTest has some <a href="http://www.scalatest.org/getting_started_with_flat_spec">BDD options</a> that look really great.
</p>
<p>
<h2>The Bad</h2>
<h3>SBT</h3>
</p>
<p>
I really wanted to like <a href="http://code.google.com/p/simple-build-tool/">SBT</a>, and, while it&#8217;s a billion times better than 
<a href="/blog/2009/05/13/why-maven-drives-me-absolutely-batty.html">maven</a>, it&#8217;s still not as easy to use as I&#8217;d like it to be.
</p>
<p>
I like:
<ul>
    <li>Building code and downloading dependencies are separate</li>
    <li>The save/run-tests loop is very handy</li>
    <li>JavaRebel + re-deploying the webapp on file save is very handy</li>
</ul>
However:
<ul>
    <li>The test output is horrid; big huge stack traces</li>
    <li><b>Constant</b> <tt>OutOfMemory</tt> errors that <b>it traps</b> and then <b>doesn&#8217;t exit</b>.  I had to <tt>kill -9</tt> SBT <b>a lot</b></li>
    <li>Still more complicated than shell scripts</li>
</ul>
I believe that a build tool should be a DSL for automating software development tasks, which means it should be more concise and easier to use than UNIX shell scripts.  Ant, Maven, and SBT
fail miserably at this.
</p>
<p>While SBT is light-years ahead by using an actual programming language, I found it very difficult to customize.  Part of this is that the scaladoc tool gives developers <b>no help</b> in documenting their API, but, when it comes down to it, Scala and Java are not system automation languages.
</p>
<h3>scaladoc</h3>
<p>
Scaladoc is nowhere near as powerful as Javadoc.  It makes it very hard to document how to use your code.   Scala should have a <b>more</b> advanced documentation system than Java, but it actually has a much more primitive one; even RDoc is better.  Hopefully, as Scala&#8217;s popularity increases, the tools surrounding it will improve.
</p>
<p>
<h2>The Ugly</h2>
<h3>J2EE Deployment</h3>
</p>
<p>
Deployment is an underappreciated aspect of why Rails is so easy to use; copy/push your code to the production server, tell it you are running in production, and go.  With J2EE, you get NONE of this. 
</p>
<p>
If you want to alter configuration based upon environment, you are entirely on your own.  J2EE, Ant, Maven, and SBT give you no real help or support; you have to roll it yourself.  I&#8217;m just shocked at this omission; J2EE is <b>ten years old</b> and <b>still</b> has not provided a solution for something that <b>every</b> project needs.  Amazing.
</p>
<p>
<h3>Servlet Spec</h3>
</p>
<p>
Java 5 is at end of life.  The latest released Servlet Spec <b>still doesn&#8217;t support generics</b> and is <b>still</b> completely schizophrenic about it&#8217;s API (some methods use <tt>Enumeration</tt>, some use arrays, some use <tt>Iterable</tt>.  Ugh).  
</p>
<p>The 3.0 spec looks slightly more sane, but it really doesn&#8217;t do us any favors.  <tt>web.xml</tt> is a trainwreck of stupidity, there&#8217;s zero support for conventions, and the whole thing just feels like a solution designed for a problem that few of us ever have.
</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/14/make-your-own-literal-in-scala.html">Make Your Own Literals in Scala</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-14T00:00:00-05:00" pubdate data-updated="true">Nov 14<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p class="first">
Following up from my post on <a href="">Deconstructing the map literal in Scala</a>, I thought it might be fun to go the other way around, and create a few literals of own.  Since Scala provides the <i>language features</i> to enable literal-like syntax, and not the actual literals themselves, we can do a lot of stuff to reduce the amount of typing we have to.
</p>
<p>
In your production code, you probably wouldn&#8217;t use a lot of literals, regardless of language support.  However, in test cases, they are much more common.  If creating
objects in your tests becomes easier, you will tend to write better tests.
</p>
<p>
Suppose we are writing a Twitter app (that&#8217;s all the rage these days, anyway).  We might define a <tt>TwitterUser</tt> class like so:
<div>
  <pre>
    <code class='scala'>class TwitterUser(val username:String) {
  def url = &quot;http://www.twitter.com/&quot; + username
  def recentTweets = // imagine some code here 
}</code>
  </pre>
</div>

</p>
<p>
We might write a few test cases:
<div>
  <pre>
    <code class='scala'>val me = new TwitterUser(&quot;davetron5000&quot;)
assertEquals(10,me.recentTweets.size)

val fake = new TwitterUser(&quot;davetron5001&quot;)
assertEquals(0,fake.recentTweets)</code>
  </pre>
</div>

and so forth.  It&#8217;s going to get a bit tedious writing <tt>new TwitterUser</tt> over and over again.  We could just make a shorter-named method in our test class, but why not use <a href="http://www.naildrivin5.com/scalatour/wiki_pages/ScalaBasics#Literals_and_Syntactic_Sugar">the <tt>apply()</tt> sugar</a> along with a <a href="http://www.naildrivin5.com/scalatour/wiki_pages/ScalaObject">singleton object</a> to make our own literal?
</p>
<p>
<div>
  <pre>
    <code class='scala'>// Along with our TwitterUser class def
object @@ { // &quot;@&quot; is a reserved word :(
  def apply(username:String) = new TwitterUser(username)
}

// back to our test code

val me = @@(&quot;davetron5000&quot;)
val fake = @@(&quot;davetron5001&quot;)</code>
  </pre>
</div>

</p>
<p>
It&#8217;s a small bit of code, and we&#8217;ve saved some typing without sacrificing readability, since we take advantage of the way Twitter refers to users via the &#8220;@&#8221; symbol.
</p>
<p>
If our app is all about Twitter, we can go a step further and just rename <tt>TwitterUser</tt> to <tt>@@</tt> like so:
<div>
  <pre>
    <code class='scala'>// This replaces the TwitterUser class 
// and @@ singleton object
case class @@(val username:String) {
  def url = &quot;http://www.twitter.com/&quot; + username
}</code>
  </pre>
</div>

This takes advantage of (the unfortunately named) <a href="http://www.naildrivin5.com/scalatour/wiki_pages/CaseClasses">case classes</a> and now our Twitter user class <b>and</b> literal-like factory are called <tt>@@</tt>.  This allows, among other things, some more readable case statements.
<div>
  <pre>
    <code class='scala'>user match {
  case @@(&quot;davetron5000&quot;) =&gt; &quot;it's you, dude&quot;
  case user:@@ =&gt; &quot;it's someone else&quot;
}</code>
  </pre>
</div>

</p>
<p>
Now, you certainly don&#8217;t want to do this for every object in your domain (you&#8217;d get a horrible mess of symbols), but for key objects that you are using everywhere, an appropriately chosen literal syntax can make your code very clean and easy to read and modify.
</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/12/deconstructing-scala-map-literal.html">Deconstructing the Scala Map Literal</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-12T00:00:00-05:00" pubdate data-updated="true">Nov 12<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p class="first">
I find that Scala is one giant <a href="">Rube Goldberg Machine</a> that manages to do something not easily be done otherwise.  By this I mean that Scala has many features that, by themselves, seem very strange, but, in combination, enable some very cool functionality.  This is why I initially started my <a href="http://www.naildrivin5.com/scalatour">personal tour of Scala</a>.  I read stuff like <a href="http://www.naildrivin5.com/scalatour/wiki_pages/ExplcitlyTypedSelfReferences">explicitly typed self-references</a> and was left scratching my head.
</p>
<p>
I thought it might be fun to deconstruct the &#8220;map literal&#8221; in Scala and observie how the features interact to create a very handy piece of code that isn&#8217;t baked into the language.  This assumes and understanding of some <a href="http://www.naildrivin5.com/scalatour/wiki_pages/ScalaBasics">Scala basics</a>.
</p>
<p>
Although Java 7 is getting map literals, Scala already has it (or so it appears):

<div>
  <pre>
    <code class='scala'>val band = Map(&quot;Dave&quot; -&gt; &quot;Bass&quot;,
                &quot;Tony&quot; -&gt; &quot;Guitar&quot;,
                &quot;Greg&quot; -&gt; &quot;Drums&quot;)</code>
  </pre>
</div>

This is not actually a literal, but enabled by Scala features to make it look like a literal.  Which means that you can use these facilities to make your own literals.  So, how does this work?
</p>
<p>
Most surprising to a Java programmer is the <tt>-&gt;</tt> operator.  This makes use of two Scala features:
<ul>
    <li><a href="http://www.naildrivin5.com/scalatour/wiki_pages/ScalaOperators">Operator-like method naming</a></li>
    <li><a href="http://www.naildrivin5.com/scalatour/wiki_pages/ImplicitConversions">Implicit Conversions</a></li>
</ul>
</p>
<p>
It turns out that the <tt>-&gt;</tt> operator is on the class <tt>Predef.ArrowAssoc</tt>.  <tt>Predef</tt> is automatically imported in every Scala program, so you don&#8217;t need to prefix anything with <tt>Predef</tt>.  It returns a tuple of its caller and its argument, e.g.
<div>
  <pre>
    <code class='scala'>val dave = new ArrowAssoc(&quot;Dave&quot;)
val entry = dave -&gt; &quot;Bass&quot;
// entry is now (&quot;Dave&quot;,&quot;Bass&quot;)
// which is a Tuple2[String,String]</code>
  </pre>
</div>

</p>
<p>
Of course, we aren&#8217;t creating <tt>ArrowAssoc</tt> instances anywhere, so how does this get called?  This is where implicits come in.  Suppose we change our simple example to:
<div>
  <pre>
    <code class='scala'>val dave = &quot;Dave&quot;
val entry = dave -&gt; &quot;Bass&quot;
// entry is still (&quot;Dave&quot;,&quot;Bass&quot;)
// which is a Tuple2[String,String]</code>
  </pre>
</div>

Here, Scala sees that the method <tt>-&gt;</tt> needs to be called on an <tt>ArrowAssoc</tt>, but is being called on a <tt>String</tt>.  Instead of giving up, Scala notices the method: 
<div>
  <pre>
    <code class='scala'>implicit def any2ArrowAssoc[A](x: A): 
  ArrowAssoc[A] = new ArrowAssoc(x)</code>
  </pre>
</div>

This means that anything at all can be converted into an <tt>ArrowAssoc</tt> if there&#8217;s some reason to.  And we have a reason to here.
</p>
<p>
This means our code is now effectively:
<div>
  <pre>
    <code class='scala'>val band = Map((&quot;Dave&quot; , &quot;Bass&quot;),
                (&quot;Tony&quot; , &quot;Guitar&quot;),
                (&quot;Greg&quot; , &quot;Drums&quot;))</code>
  </pre>
</div>

It&#8217;s not hard to imagine a <tt>Map</tt> constructor taking <tt>Tuple2</tt>, using the first part as the key and the second part as the value, however where is the constructor?  Scala creates objects via the <tt>new</tt> keyword, just as Java does.  So, what&#8217;s going on here?
</p>
<p>
This use two additional Scala features:
<ol>
    <li><a href="http://www.naildrivin5.com/scalatour/wiki_pages/ScalaBasics#Literals_and_Syntactic_Sugar"><tt>apply()</tt>
        shortcutting</a>
    <li><a href="http://www.naildrivin5.com/scalatour/wiki_pages/ScalaObject">Scala singleton objects</a></li>
</ol>
This is much simpler to decode than the <tt>-&gt;</tt> method; there is simply an object in scope named <tt>Map</tt>, and it has an <tt>apply</tt> method that takes a variable list of <tt>Tuple2</tt> objects.  Scala interprets a method-call syntax on an object, but lacking a method name, as a call to the <tt>apply</tt> method of that object (if it exists).  So, removing this, we have:
<div>
  <pre>
    <code class='scala'>val band = Map.apply((&quot;Dave&quot; , &quot;Bass&quot;),
                      (&quot;Tony&quot; , &quot;Guitar&quot;),
                      (&quot;Greg&quot; , &quot;Drums&quot;))</code>
  </pre>
</div>

</p>
<p>
That&#8217;s all there is to it!  A few things to note about this:
<ul>
    <li>Without the application of some Scala features, it&#8217;s pretty ugly</li>
    <li>The language itself didn&#8217;t need to implement a special &#8220;map literal&#8221;; it simply combines smaller features
    in a way to make it appear as though it does.  You can even create your own &#8220;literals&#8221; rather than waiting for
    the language to implement them</li>
</ul>
</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/11/01/why-gitub-can-opensource-their-libraries.html">Why Github Can Open-Source Their Libraries</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-11-01T00:00:00-04:00" pubdate data-updated="true">Nov 1<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p class="first">
One thing I love about Github is that they open-source a <b>lot</b> of their internal tools that power the site.  What&#8217;s interesting is that, unlike SourceForge, they open source little bits and pieces; tiny libraries that do one specific thing.  These things are supremely useful (I use <a href="http://www.github.com/davetron5000/grit">Grit</a> and <a href="http://www.github.com/mojombo/jekyll">Jekyll</a> quite often).
</p>
<p>This is a huge benefit to them; their products become higher-quality through contribution, and their talent-pool increases due to their contribution to the community; they are positioned as a technical leader and social force in the development community.  I&#8217;ve often wondered why more companies don&#8217;t do this and what&#8217;s really involved?
</p>
<p>
There are three main hurdles to overcome in order to do this:
<ul>
    <li><b>Usefulness</b> - do you have code that someone will find useful?</li>
    <li><b>Legalish</b> - are you comfortable giving away some part of your company&#8217;s intellectual property?</li>
    <li><b>Technical</b> - does your technical infrastructure support extraction, collaboration, and re-integration?</li>
</ul>
</p>
<p>
<h3>Usefulness</h3>
I think comparing Github to Sourceforge makes this point very clear.  While SourceForge does <b>more</b> than, say, <a href="http://github.com/mojombo/bert">BERT</a>, it&#8217;s just a big huge all-or-nothing proposition; Github has extracted small parts of their infrastructure useful outside the realm of &#8220;software project hosting&#8221;, resulting in many useful, fine-grained libraries.
</p>
<p>
<h3>Legalish</h3>
The issue here is essentially to determine if the gains achieved by open-sourcing some of your code are <i>greater</i> than the competitive advantage <i>lost</i> by doing so.  Again, the ability to extract small, focused, and useful pieces of functionality is key.  Github isn&#8217;t open-sourcing their entire infrastructure; just the parts that are really useful and not incidental to their success (though one may argue that their IP has <b>nothing</b> to do with their success).
</p>
<p>
<h3>Technical</h3>
Here&#8217;s where things get interesting.  Extracting a small, useful piece of technology from your application, without revealing any trade secrets or other IP can be a challenging task.  Add to that the infrastructure needed to manage and incorporate contributions, and your technical infrastructure could be the main barrier to interacting with the community (and <b>not</b> the lawyers!).
</p>
<p>
My company struggles with this daily, as our tools were just not designed to make extraction and management of dependencies easy.  Our problem is almost entirely based on tooling and technology choice (which I&#8217;ll get into in a further post).
</p>
<p>
<h3>Conclusion</h3>
The advantages to open-sourcing some of your code are obvious: you can improve the quality of your codebase while improving your standing in the community (which enahnces your ability to attract top-talent).  You just need to make sure your technical infrastructure is built for it, and that the lines of communication between the development staff and the legal staff are clear and functional.
</p>
<p>
That Github routinely open-sources bits of their code speaks volumes to the choices they&#8217;ve made as an organization, as well as their technical prowess.
</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2009/10/27/joel-spolsky-at-devdays.html">An Anecdote About Joel Spolksy at DevDays DC</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-10-27T00:00:00-04:00" pubdate data-updated="true">Oct 27<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
I had signed up to volunteer at DC&#8217;s DevDays, however <a href="http://www.opower.com">My Company</a> decided to be a local sponsor.  Part of that involed us having some time for a 15-minute presentation during the lunch break.  We were told that other sponsors would be doing something similar.  I worked up a <a href="http://www.slideshare.net/davetron5000/measuring-agile-process-shorter-2359457">brief presentation on how we improve our development process with each iteration</a>.  I figured it would be of interest and not be too (obviously) self-promoting.
</p>
<p>
We get there and find out that not only are none of the other sponsors doing this, but we can&#8217;t go at lunch, because Joel very-much wanted these things to be &#8220;optional&#8221; and, The State Theater being near almost nowhere to go have lunch, everyone would be stuck there and &#8220;forced&#8221; to watch our presentation.  So, we&#8217;d be going <b>after</b> the entire conference was over.  
</p>
<p>
I have no problem with this at all; it&#8217;s his/their conference after all.  But, we probably wouldn&#8217;t have bothered if we had known this ahead of time. Nevertheless, I <a href="http://search.twitter.com/search?q=process+%23devdays+from%3Adavetron5000">tweeted</a> to the #DevDays hashtag (showing up on the big screen between speakers) and looked forward to it anyway.  As a member of a crappy local band, I&#8217;ve played some gigs to no-one, so it&#8217;s no big deal.
</p>
<p>
For most of the day the end of the schedule looked like:
<ul>
    <li style="font-size: 120%">4:15 - JQuery</li>
    <li style="font-size: 120%">5:30 - Goodbye!</li>
    <li style="font-size: 70%">(unspecified showcase for OPOWER (formerly Positive Energy))</li>
</ul>
</p>
<p>
Toward the end, Joel came by, introduced himself, and got my info so he could mention it in his closing remarks.  We discussed some logistics and he was very polite, but obviously had a lot going on.  
</p>
<p>
While Richard Worth was finishing up his JQuery talk, I head to the back.  The stagehand gets me set up and Joel is about to go deliver the &#8220;goodbye and thanks&#8221; speech.   Here is my mostly accurate transcription of our brief discussion:
<ul>
    <li><b>Joel:</b> <i>OK, I&#8217;m gonna go out, say goodbye, and then I&#8217;ll play a song that goes for about 4 minutes.  After that,
        you can head out and start</i></li>
    <li><b>Me:</b> <i>No problem, can you or someone cue me when the song is almost over? [you couldn&#8217;t hear much back there and I
        didn&#8217;t know the song]</i></li>
    <li><b>Joel:</b> <i>My experience running these things is that people will start leaving pretty soon, so once it looks like
        everyone&#8217;s left, you can head out there</i></li>
    <li><b>Me:</b> <i>Um, ok [mostly amused at his comment and a bit nervious]</i></li>
    <li><b>Joel:</b> <i>[slighly chuckling] We try to have a strict separation of Editorial and Advertorial content at these</i></li>
    <li><b>Me:</b> <i>[not quite parsing the word &#8220;Advertorial&#8221; and also thinking about the hour-long demo on FogBugz] </i></li>
</ul>
As I said, it was all good, and a few people DID stick around, but I found the whole thing rather amusing in retrospect.  And I think he actually paid attention to about half of my talk!
</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/10/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/8/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>
  <img class="left" src="http://www.gravatar.com/avatar/ae52d95bbc43d0a62044a9a6b5674de0.png">
  I&#8217;m a programmer, musician, and <a href="http://www.theseniorsoftwareengineer.com">author</a>.  I speak frequently at national and regional conferences and spend my days currently as a lead engineer at <a href="http://www.stitchfix.com">Stitch Fix</a>. I&#8217;ve written applications in C, C++, Perl, Ruby, Scala, and many others, on large and small teams. As a developer, I believe in clean code, making it right, providing a great user experience and using the right tool for the job.  As a bass player, I believe in using a pick, locking it down, and ripping off Peter Hook.  As an author, I insist on the Oxford Comma, try to avoid semi-colons, and dislike title case.
  </p>
</section>
<section>
  <p>
  <a href="http://www.theseniorsoftwareengineer.com"><img class="center" src="http://www.theseniorsoftwareengineer.com/images/cover.png"></a>
  <a href="http://pragprog.com/book/dccar/build-awesome-command-line-applications-in-ruby"><img class="center" src="http://imagery.pragprog.com/products/249/dccar_xlargebeta.jpg?1319573406"></a>
  </p>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/davetron5000">@davetron5000</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'davetron5000',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("davetron5000", 5, true);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/davetron5000" class="twitter-follow-button" data-show-count="false">Follow @davetron5000</a>
  
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/09/13/my-book-is-on-sale.html">&dagger; My Book is On Sale</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/06/chromebook-keyboard-slightly-innovative.html">Chromebook Keyboard Slightly Innovative</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/29/a-real-keyboard-for-programmers.html">A real keyboard for programmers?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/21/inconsistent-architecture.html">&#10106;&#10144; Inconsistent Architecture</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/08/responsible-refactoring.html">&#10106;&#10144; Responsible Refactoring</a>
      </li>
    
  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - David Bryant Copeland -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>


<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>My first iPhone App - Part 2 - Naildrivin' &#10106;</title>
  <meta name="author" content="David Bryant Copeland">

  
  <meta name="description" content="See Part 1 first For the past several days I&#8217;ve had the app on my phone and used it to enter in wines to see how the UI was working. Yesterday &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.naildrivin5.com/blog/2010/06/27/iphone-app-part-2.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Naildrivin' &#10106;" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-10518541-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <meta name="google-site-verification" content="h_yTpXa6N3ebHj8DYmgX4lIFGHBW1NtGMVHfXuu7i_4" />
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Naildrivin' &#10106;</a></h1>
  
    <h2>&#10144; Website of David Bryant Copeland</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.naildrivin5.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="http://www.theseniorsoftwareengineer.com">My New Book!</a></li>
  <li><a href="/scalatour">Scala Tour</a></li>
  <li><a href="/talks">Talks</a></li>
  <li><a href="/blog/archives">Blog Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">My First iPhone App - Part 2</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-06-27T00:00:00-04:00" pubdate data-updated="true">Jun 27<span>th</span>, 2010</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><em>See <a href="/blog/2010/06/23/iphone-app-part-1.html">Part 1</a> first</em></p>

<p>For the past several days I&#8217;ve had the app on my phone and used it to enter in wines to see how the UI was working.  Yesterday, I integrated
Core Data (Apple&#8217;s Object/Relational Mapper (ORM), for lack of a better description) so that I could actually <em>save</em> some data.  I discovered some nuances to using Core Data, as well as a refinement in the UI.</p>

<h2>UI</h2>

<p>Last night, I had both my girlfriend Amy and my good friend Clay (who is also reasonably into wine) play around with the &#8220;new wine&#8221; screen.  Neither have an iPhone, and there were a few obvious problems:</p>

<ul>
<li>They were very unaccustomed to the &#8220;Done&#8221; button being in the upper-right corner, as well as the &#8220;slot-machine&#8221; control</li>
<li>Both had trouble with the &#8220;Wine Name&#8221; concept</li>
<li>Both had trouble dismissing the keyboard</li>
<li>Clay thought he was entering search terms and not a new Wine</li>
</ul>


<p>Later that evening, I had a glass of wine at a bar and entered it into my app.  Up until this point, I was just typing in wines I knew about, so this was the first &#8220;real use&#8221; of the app in the field.  I quickly realized that the &#8220;Wine Name&#8221; concept, while important, was too vague and confusing to be the first field you enter.  Most wines are known by the vineyard and some don&#8217;t even have proper names or appellations.  So, I swapped the fields and added some examples in the placeholder text:</p>

<p><img src="/images/wine_brain_new_wine_comparison.jpg" alt="Comparison" /></p>

<p>I also added a title to indicate that this screen is for adding a new wine.  Finally, I used the <a href="http://stackoverflow.com/questions/804563/how-to-hide-the-keyboard-when-empty-area-is-touched-on-iphone">background button trick</a> along with some events on the rating and type controls to dismiss the keyboard if you tap anywhere outside of a text field.</p>

<p>This feels much cleaner and flows a bit better.  While varietal is probably the third most important thing (at least for New World wines), the slot-machine control would be awkwardly placed right below the vineyard/vintage text fields, so I left it where it was.</p>

<p>As to Clay and Amy&#8217;s confusion over some idiomatic iPhone design choices, I&#8217;m not worrying about them a whole lot; a typical iPhone user will understand what&#8217;s going on (I hope :).</p>

<h2>Core Data</h2>

<p>Backing all this is Apple&#8217;s Core Data, which grew out of the <a href="http://en.wikipedia.org/wiki/Enterprise_Objects_Framework">Enterprise Objects Framework</a> (and was, incidentally, my first exposure to an ORM way back in 1998), is the simplest and most idiomatic way to store and manage data on the iPhone.  As with Interface Builder, you create the model visually, using a simplistic data modelling tool.  I set up the bare bones of my data model and generated the classes.</p>

<p><img src="/images/wine_brain_data_model.jpg" alt="Data Model" /></p>

<p>The first problem I ran into was in changing the model after the database had been created on the device.  Core Data doesn&#8217;t migrate your model for you by default.  I ended up starting over with a &#8220;versioned&#8221; model and implementing their default migration.  This will probably work for simple changes, but for more complex changes, it looks like it&#8217;s somewhat difficult to migrate the model.  An unfortunate reason to do some Big Design Up Front.</p>

<p>My next problem was initializing reference data.  In my case, I wanted the list of varietals as well as the list of wine types (e.g. &#8220;red&#8221;, &#8220;white&#8221;) to be in the database and managed by Core Data.  I ended up creating an array of the values inside the app and then checking the database for their existence, adding them if they were missing.  It&#8217;s a bit cheesy, but I can extract the lists to plist files later.  It <em>did</em> give me a chance to play with Objective-C&#8217;s blocks feature.  I needed to map my list of <code>Varietal</code> objects to a list of strings, so I could compare that list against my default list.  While <code>NSArray</code> doesn&#8217;t provide a map function, it does provide the equivalent of Ruby&#8217;s <code>each</code> or Scala&#8217;s <code>foreach</code>.  In true Apple/Objective-C style, it&#8217;s called <code>enumerateObjectsUsingBlock</code> :)</p>

<div>
  <pre>
    <code class='objc'>NSMutableArray *strings = [NSMutableArray arrayWithCapacity:[array count]];
[array enumerateObjectsUsingBlock:^(id obj, NSUInteger i, BOOL *stop) {
    [strings addObject:[obj valueForKey:@&quot;name&quot;]];
}];</code>
  </pre>
</div>


<p>The <code>stop</code> pointer is an out-only variable that you set to YES to allow for an early exit from the loop.  I&#8217;m glad they&#8217;ve adopted this functional style; I forsee explicit loops becoming just as quaint as GOTOs in the near future.</p>

<p>One thing bugged me about this process, however.  I had these generated classes and it wasn&#8217;t clear how to add my own methods to them without losing the code every time I re-generated my model.  Enter <a href="http://github.com/rentzsch/mogenerator">mogenerator</a>.  This provides a more sophisticated bit of code generation, givng you two classes for each model: one for machines (i.e. for Core Data to manage) and a subclass for people (to which I can add custom methods).  Perfect!  I wasn&#8217;t able to incorporate it into XCode, but I&#8217;m happy running in on the command line as needed for now.</p>

<h2>Random Bits</h2>

<p>I spent more time than I would&#8217;ve liked tracking down a nasty bug where every attempt to convert a string to a number (for the wine vintage year) resulted in a <code>nil</code> number.  It turns out I was confused about when some object lifecycle methods were being called and my pointer to an <code>NSNumberFormatter</code> was, in fact, pointing to <code>nil</code>.  Unlike Java, where you&#8217;d get a <code>NullPointerException</code>, or C, where you&#8217;d get a core dump, it seems Objective-C just returns <code>nil</code> and doesn&#8217;t even issue a warning.  Very strange.  Once I realized that, the solution was obvious.</p>

<p>I&#8217;m still not 100% sure I&#8217;m structuring my code properly, but Stack Overflow&#8217;s stalwart iPhone SDK answerers have been <em>incredibly</em> helpful in pointing me in the right direction.</p>

<h2>Next Steps</h2>

<p>Now that I&#8217;ve got the ability to save and retrieve data, the next step is to start looking to browsing, viewing, and editing the database.  I think the domain is restricted enough that I can use the iPhone&#8217;s idiomatic drill-down table navigation to filter the database.</p>

<p>Continued in <a href="/blog/2010/06/29/iphone-app-part-3.html">Part 3</a>, <a href="/blog/2010/07/08/iphone-app-part-4.html">Part 4</a>, and <a href="/blog/2010/07/18/iphone-app-part-5.html">Part 5</a></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">David Bryant Copeland</span>
  </span>

      








  


<time datetime="2010-06-27T00:00:00-04:00" pubdate data-updated="true">Jun 27<span>th</span>, 2010</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.naildrivin5.com/blog/2010/06/27/iphone-app-part-2.html" data-via="davetron5000" data-counturl="http://www.naildrivin5.com/blog/2010/06/27/iphone-app-part-2.html" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2010/06/23/iphone-app-part-1.html" title="Previous Post: My first iPhone App - Part 1">&laquo; My first iPhone App - Part 1</a>
      
      
        <a class="basic-alignment right" href="/blog/2010/06/29/iphone-app-part-3.html" title="next Post: My first iPhone App - Part 3">My first iPhone App - Part 3 &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>
  <img class="left" src="http://www.gravatar.com/avatar/ae52d95bbc43d0a62044a9a6b5674de0.png">
  I'm a programmer, musician, and <a href="http://www.theseniorsoftwareengineer.com">author</a>.  I speak frequently at national and regional conferences and spend my days currently as a lead engineer at <a href="http://www.stitchfix.com">Stitch Fix</a>. I've written applications in C, C++, Perl, Ruby, Scala, and many others, on large and small teams. As a developer, I believe in clean code, making it right, providing a great user experience and using the right tool for the job.  As a bass player, I believe in using a pick, locking it down, and ripping off Peter Hook.  As an author, I insist on the Oxford Comma, try to avoid semi-colons, and dislike title case.
  </p>
</section>
<section>
  <p>
  <a href="http://www.theseniorsoftwareengineer.com"><img class="center" src="http://www.theseniorsoftwareengineer.com/images/cover.png"></a>
  <a href="http://pragprog.com/book/dccar/build-awesome-command-line-applications-in-ruby"><img class="center" src="http://imagery.pragprog.com/products/249/dccar_xlargebeta.jpg?1319573406"></a>
  </p>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/davetron5000">@davetron5000</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'davetron5000',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("davetron5000", 5, true);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/davetron5000" class="twitter-follow-button" data-show-count="false">Follow @davetron5000</a>
  
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/06/30/thinking-in-types.html">&#10106;&#10144; Thinking In Types</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/12/resque-brain-a-better-resque-web-ui.html">&dagger; Resque Brain - a Better Resque Web UI</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/05/understanding-new-programming-languages.html">Understanding New Programming Languages</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/04/what-swift-tells-use-about-programming-language-trends.html">&#10106;&#10144; What Swift Tells Us About Programming Language Trends</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/27/rails-does-not-define-your-application-architecture.html">&#10106;&#10144; Rails Does Not Define Your Application Architecture</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - David Bryant Copeland -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>

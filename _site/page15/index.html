
<!DOCTYPE html>
<html language="en"><head>
  <meta charset="utf-8">
  <title>naildrivin5.com - David Bryant Copeland's Website</title>
  <meta name="author" content="XXX">

  
  <meta name="description" content="
  
  
  
    
      
  
    Ruby's awesomely dangerous awesomeness
  
  
    
      








  




    
  


  
While packaging my resume creato...">
  

  
  <link rel="canonical" href="http://naildrivin5.com/page15/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="" rel="alternate" title="naildrivin5.com - David Bryant Copeland's Website" type="application/atom+xml">
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', '']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <meta name="google-site-verification" content="h_yTpXa6N3ebHj8DYmgX4lIFGHBW1NtGMVHfXuu7i_4" />
</head>
<body>
  <div class="blog-index">
  
  
  
    <article>
      <header>
  
    <h1 class="entry-title"><a href="/blog/2008/10/31/rubys-awesomely-dangerous-awesomeness.html">Ruby's awesomely dangerous awesomeness</a></h1>
  
  
    <p class="meta">
      








  



<time datetime="2008-10-31T00:00:00-04:00" pubdate data-updated="true"></time>
    </p>
  
</header>

  <div><p>
While packaging <a href="http://github.com/davetron5000/daves-resume">my resume</a> creator/formatter as a Ruby Gem, I noticed my command line parser was preventing my code from running.  It has this hook that sets up an "auto run" sequence (your code just defines a <tt>main</tt> method):
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">inherited</span><span class="p">(</span><span class="n">child_class</span><span class="p">)</span>
  <span class="vc">@@appname</span> <span class="o">=</span> <span class="nb">caller</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="sr">/.*:/</span><span class="o">][</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">2</span><span class="o">]</span>
  <span class="vc">@@child_class</span> <span class="o">=</span> <span class="n">child_class</span>
  <span class="k">if</span> <span class="vc">@@appname</span> <span class="o">==</span> <span class="vg">$0</span>
    <span class="n">__set_auto_run</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>
the problem is that <tt>$0</tt> from gem is the <tt>/usr/bin</tt> location and <tt>@@appname</tt> is the <b>actual</b> location in the Gem repository.  Not sure why this check was there, but I had a problem.
</p>
<p>
Not feeling like overhauling the command line interface code and not being able to patch OptionParser, I opted instead to use the dangerous-sounding ruby feature of <i>replacing the method with my own implementation</i>:
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">CommandLine</span><span class="o">::</span><span class="no">Application</span>
  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
    <span class="k">alias</span> <span class="n">old_inherited</span> <span class="n">inherited</span>

    <span class="k">def</span> <span class="nf">inherited</span><span class="p">(</span><span class="n">child_class</span><span class="p">)</span>
      <span class="vc">@@appname</span> <span class="o">=</span> <span class="nb">caller</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="sr">/.*:/</span><span class="o">][</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">2</span><span class="o">]</span>
      <span class="vc">@@child_class</span> <span class="o">=</span> <span class="n">child_class</span>
      <span class="n">normalized_appname</span> <span class="o">=</span> <span class="vc">@@appname</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/^.*\//</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
      <span class="n">normalized_dollar0</span> <span class="o">=</span> <span class="vg">$0</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/^.*\//</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="n">normalized_appname</span> <span class="o">==</span> <span class="n">normalized_dollar0</span>
        <span class="n">__set_auto_run</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>
Now <b>that's</b> pretty cool.  My code just dynamically patches the broken Gem!  The power of open source and dynamic languages.  Of course, this feature allows so much awful code to be written....
</p>
</div>
  
  


    </article>
  
  
    <article>
      <header>
  
    <h1 class="entry-title"><a href="/blog/2008/10/24/50.html">Interview Rubric really needed?</a></h1>
  
  
    <p class="meta">
      








  



<time datetime="2008-10-24T00:00:00-04:00" pubdate data-updated="true"></time>
    </p>
  
</header>

  <div><p>It's been a few weeks of job hunting and I haven't once had to make a decision that <a href="http://www.naildrivin5.com/daveblog5000/?p=47">my post on interviewing</a> would've helped resolve.  The fact is, you get a feel almost immediately for a place, and the reasons you say "yes" or "no" have more to do with <b>who</b> you'll be working with than the number of monitors you get.  Usually, a place that's using ancient COTS products has put up red flags far earlier in the process.  And the jobs I get excited about have nothing to do with their use of Git.
</p>
<p>
Some lowlights:
<ul>
<li>Left waiting for so long, I had to walk out of the interview in order to meet an appointment.  The receptionist explained "Well, they have a lot of work to get done!"  Good luck with getting it done.</li>
<li>A guy giving a tech interview (for a J2EE position) couldn't understand how a Swing front-end to an EJB/JPA backend could possibly be called J2EE.</li>
<li>Being asked a logic question and, as soon as I used the right word while thinking out loud (in this case "tree"), was cut off and we moved to the next question. After 10 minutes of this, he walked out without telling me anything about the company or job.</li>
<li>Being offered a job after having <b>No</b> technical questions asked of me.  Gee, who else is working there?</li>
<li>Interviewing in a place where <b>every</b> single aspect of the work environment was crappier than the crappiest house I've ever lived.  If <b>I</b> can afford a fresh coat of paint every few years, shouldn't some "global enterprise solution consulting firm" be able to swing it?</li>
<li>A Java development shop using....Visual Source Safe.  I think <tt>cp Foo.java Foo.java.bak</tt> might be better</li>
</ul>
Of course, there's been some legitimate highlights as well:
<ul>
<li>Being asked some challenging questions about concurrency and data structures.  You may not ever have to implement a linked-list, but anyone should know it and when I'm asked, it's a definite plus that the people on the other end know what they are doing</li>
<li>Being asked to write code.  So far, exactly <b>two</b> positions have asked me write code in the interview.  Thank god for them, or my faith would be shaken; seriously.  I'm always <b>very</b> nervous when I'm applying for a job where I have to write code and no one seems to need any proof that I can do it.  It makes me wonder who else is working there</li>
<li>Solid explanations of the business or project.  I used to think this was a no-brainer, but more often than not, I come away from a second interview with NO IDEA what I'd be doing if I took the job.</li>
</ul>
</p>
<p>
Criteria is only useful when you have to narrow down a lot of choices.  I'd love to have so many great opportunities that I could just pick the one where I can develop on a Mac, or the one with the nicest office (all other things being equal).  Sadly, that is not the case around here.  It seems very few of my colleagues are being too particular, and I can't help wondering what effect it might have on, well, <b>the world</b> if clueless developers were not as employable as it seems they are.
</p>
</div>
  
  


    </article>
  
  
    <article>
      <header>
  
    <h1 class="entry-title"><a href="/blog/2008/10/14/things-id-like-to-leave-behind.html">Things I'd like to leave behind</a></h1>
  
  
    <p class="meta">
      








  



<time datetime="2008-10-14T00:00:00-04:00" pubdate data-updated="true"></time>
    </p>
  
</header>

  <div><p>
<ul>
<li><b>Subversion</b> - Git is so much better in so many ways (it goes without saying that CVS should be allowed to die)</li>
<li><b>JUnit</b> - TestNG does all that JUnit does and more; what does JUnit even have to offer these days?</li>
<li><b>Java 1.4</b> - Java without generics is just so much pain</li>
<li><b>Java Web Frameworks</b> - As far as I can tell, <b>none</b> of them adequately address one of the fundamental problems in web development, which is to simplify the creation of the UI.</li>
<li><b>Ant</b> - Ant has always been the world's worst build automation language; who creates a build tool without variables, loops and conditionals?  We can do better (and Maven doesn't appear to be it)</li>
<li><b>Checked exceptions</b> - <tt>java.lang.Exception</tt> is possibly the worst class in the Java library; should never be caught nor thrown<sup>1</sup></li>
<li><b>Misuses of XML</b> - XML has a purpose, and it's not as a programming language or configuration file format.  Any notion that XML is anything other than a <b>binary format</b> is misguided</li>
</ul>
</p>
<p><i>
<sup>1</sup>API developers should be allowed to declare that they throw <tt>Exception</tt> to allow subclasses to throw whatever they want with impunity, however <tt>Throwable</tt> is the preferred thing to catch for catch-alls, and the entire exception mechanism in Java is woefully broken.</i>
<p>
</div>
  
  


    </article>
  
  
    <article>
      <header>
  
    <h1 class="entry-title"><a href="/blog/2008/10/14/ruby-and-dead-simple-code-coverage.html">Ruby and dead simple code coverage</a></h1>
  
  
    <p class="meta">
      








  



<time datetime="2008-10-14T00:00:00-04:00" pubdate data-updated="true"></time>
    </p>
  
</header>

  <div><p>
I haven't used a code coverage tool for Java, but in my spare time I've been working up some Ruby code (mostly to learn the language).  I'm using Test Driven Development, which is slightly simpler with Ruby than with Java (mostly due to Ruby's interpreted nature).
</p>
<p>
I had heard about <a href="http://eigenclass.org/hiki.rb?rcov ">rcov</a> and decided to give it a shot.  Within literally <b>5 minutes</b> I had it installed and a report showing my tests were not covering all my code!  Amazing.  I could then easily see <b>exactly</b> where I need to to test and, sure enough, found some bugs that would've gone unnoticed.  
</p>
<p>
Even the best tool with Java would've required some painful ant tweaking (not to mention hopes and prayers that it worked with TestNG).  I already cannot imagine writing tests without being able to view the coverage....
</p>
</div>
  
  


    </article>
  
  
    <article>
      <header>
  
    <h1 class="entry-title"><a href="/blog/2008/10/07/interviewing-the-interviewer-a-rubric.html">Interviewing the Interviewer: A Rubric</a></h1>
  
  
    <p class="meta">
      








  



<time datetime="2008-10-07T00:00:00-04:00" pubdate data-updated="true"></time>
    </p>
  
</header>

  <div><p>
Sad to say, my time at Gliffy is at an end (:sniff:), so I'm heading back into the job pool.  I was lucky to get some time in at Gliffy, because, living in Washington, DC, my opportunities for sexy cutting-edge jobs are about zilch.  Instead, I'm facing a <b>huge</b> market of "Senior JBoss Portal Maintenance Archiect" type jobs.</p>
<p>I guess I should feel lucky that there's lots of positions out there, but I really don't want to be the cog in a huge machine.  Gliffy has shielded me from the Horror That Can Be Consulting, so I need to keep my perspective in such trying times.  So, calling on my experiences before Gliffy, I've made this handy rubric to make sure I explore all facets of a potential position.
</p>
<p>
I don't expect anyone to get all positives and no negatives (I've certainly never been anywhere that perfect), bit it's always good to know.  For example, if I have to put up with PVCS, I better be sitting on an Aeron chair and be using a normalized database.  Further, this is obviously in addition to standard questions regarding what the project is about (i.e. is it interesting) and what the people are like.  A whole lot of this can be forgiven by being part of a great team or working on a really cool product.
</p>
<p>
<table border="1">
    <tr><th>Question</th><th>Points for</th><th>Points against</th></tr>
    <tr>
        <td style="border: solid thin black; color: black; text-align: left; font-weight: bold; background:#eeeeee;" valign="top">How do you fare on the Joel Test?</td>
        <td style="border: solid thin black; color: black; text-align: left; background:#bbffbb;" valign="top">
            &middot; High score<br />
            &middot; Good explanations for missing items
        </td>
        <td style="border: solid thin black; color: black; text-align: left; background:#ffbbbb;" valign="top">
            &middot; Low score<br />
            &middot; Never heard of it
        </td>
    </tr>
    <tr>
        <td style="border: solid thin black; color: black; text-align: left; font-weight: bold; background:#eeeeee;" valign="top">Describe your development process</td>
        <td style="border: solid thin black; color: black; text-align: left; background:#bbffbb;" valign="top">
            &middot; Structured<br />
            &middot; Easily described
        </td>
        <td style="border: solid thin black; color: black; text-align: left; background:#ffbbbb;" valign="top">
            &middot; Overly draconian<br />
            &middot; Lack of<br />
            &middot; Not easily described
        </td>
    </tr>
    <tr>
        <td style="border: solid thin black; color: black; text-align: left; font-weight: bold; background:#eeeeee;" valign="top">What kind of computer will I be using to develop?</td>
        <td style="border: solid thin black; color: black; text-align: left; background:#bbffbb;" valign="top">
            &middot; Two monitors<br />
            &middot; Mac<br />
            &middot; Linux<br />
            &middot; Administrator access
        </td>
        <td style="border: solid thin black; color: black; text-align: left; background:#ffbbbb;" valign="top">
            &middot; Vague answer<br />
            &middot; Small monitor<br />
            &middot; Windows<br />
            &middot; Locked-down
        </td>
    </tr>
    <tr>
    <td style="border: solid thin black; color: black; text-align: left; font-weight: bold; background:#eeeeee;" valign="top">Do you block certain sites or applications on your network?</td>
    <td style="border: solid thin black; color: black; text-align: left; background:#bbffbb;" valign="top">
    &middot; Open network
    </td>
    <td style="border: solid thin black; color: black; text-align: left; background:#ffbbbb;" valign="top">
    &middot; Closed network
    </td>
    </tr>
    <tr>
    <td style="border: solid thin black; color: black; text-align: left; font-weight: bold; background:#eeeeee;" valign="top">What is the physical environment like?</td>
    <td style="border: solid thin black; color: black; text-align: left; background:#bbffbb;" valign="top">
    &middot; Good Chairs<br />
    &middot; Private office<br />
    &middot; Natural light<br />
    &middot; Reasonable Temperature
    </td>
    <td style="border: solid thin black; color: black; text-align: left; background:#ffbbbb;" valign="top">
    &middot; Old, crappy<br />
    &middot; Bullpen style
    </td>
    </tr>
    <tr>
    <td style="border: solid thin black; color: black; text-align: left; font-weight: bold; background:#eeeeee;" valign="top">Am I required or encouraged to use Windows?</td>
    <td style="border: solid thin black; color: black; text-align: left; background:#bbffbb;" valign="top">
    &middot; No, few devs use Windows
    </td>
    <td style="border: solid thin black; color: black; text-align: left; background:#ffbbbb;" valign="top">
    &middot; Yes
    </td>
    </tr>
    <tr>
    <td style="border: solid thin black; color: black; text-align: left; font-weight: bold; background:#eeeeee;" valign="top">What collaboration tools do you use?</td>
    <td style="border: solid thin black; color: black; text-align: left; background:#bbffbb;" valign="top">
    &middot; Wikis<br />
    &middot; IM<br />
    &middot; Bug tracking<br />
    &middot; Sensible PM
    </td>
    <td style="border: solid thin black; color: black; text-align: left; background:#ffbbbb;" valign="top">
    &middot; Email word documents<br />
    &middot; MS-project<br />
    &middot; SharePoint<br />
    &middot; Other proprietary crap (e.g. eRoom, Documentum)<br />
    &middot; No tools
    </td>
    </tr>
    <tr>
    <td style="border: solid thin black; color: black; text-align: left; font-weight: bold; background:#eeeeee;" valign="top">What are some of your HR policies?</td>
    <td style="border: solid thin black; color: black; text-align: left; background:#bbffbb;" valign="top">
    &middot; Few, if any<br />
    &middot; Loose dress code<br />
    &middot; Flexible schedule
    </td>
    <td style="border: solid thin black; color: black; text-align: left; background:#ffbbbb;" valign="top">
        &middot; Draconian<br />
        &middot; Dress code<br />
        &middot; Core hours
    </td>
    </tr>
    <tr>
    <td style="border: solid thin black; color: black; text-align: left; font-weight: bold; background:#eeeeee;" valign="top">Can I see the code I will be working with?</td>
        <td style="border: solid thin black; color: black; text-align: left; background:#bbffbb;" valign="top">
        &middot; Letting me see it<br />
        &middot; Meaningful javadocs/API documentation<br />
        &middot; Structured, consistent style<br />
        &middot; Sensible class names and file organization<br />
        &middot; Sane build process
    </td>
    <td style="border: solid thin black; color: black; text-align: left; background:#ffbbbb;" valign="top">
        &middot; Not letting me see it<br />
        &middot; Mix of styles<br />
        &middot; No javadocs<br />
        &middot; Empty javadocs<br />
        &middot; Convoluted file organization<br />
        &middot; Broken build file
    </td>
    </tr>
    <tr>
    <td style="border: solid thin black; color: black; text-align: left; font-weight: bold; background:#eeeeee;" valign="top">How do you do testing?</td>
    <td style="border: solid thin black; color: black; text-align: left; background:#bbffbb;" valign="top">
        &middot; Have testers<br />
        &middot; Do unit tests<br />
        &middot; Maintain tests<br />
        &middot; TDD<br />
        &middot; Bug tracker
    </td>
    <td style="border: solid thin black; color: black; text-align: left; background:#ffbbbb;" valign="top">
    &middot; Ad hoc<br />
    &middot; Lip service to test-first<br />
    &middot; No unit tests
    </td>
    </tr>
    <tr>
    <td style="border: solid thin black; color: black; text-align: left; font-weight: bold; background:#eeeeee;" valign="top">What is your approach to configuration management?</td>
    <td style="border: solid thin black; color: black; text-align: left; background:#bbffbb;" valign="top">
    &middot; Having an approach<br />
    &middot; Git<br />
    &middot; Database migrations<br />
    &middot; Know the versions of 3rd party software/have a baseline configuration<br />
    &middot; Organized
    </td>
    <td style="border: solid thin black; color: black; text-align: left; background:#ffbbbb;" valign="top">
    &middot; No approach<br />
    &middot; CVS<br />
    &middot; Perforce, ClearCase, other closed crud<br />
    &middot; Shared drives<br />
    &middot; Can't describe versions/configuration
    </td>
    </tr>
    <tr>
    <td style="border: solid thin black; color: black; text-align: left; font-weight: bold; background:#eeeeee;" valign="top">Can I see the database schema I'll be working with?</td>
        <td style="border: solid thin black; color: black; text-align: left; background:#bbffbb;" valign="top">
        &middot; Letting me see it<br />
        &middot; Normalized<br />
    &middot; Sane names (no TBL_* bullshit)<br />
        &middot; Synthetic numeric keys<br />
        &middot; Referential integrity<br />
        &middot; Documented!<br />
        &middot; Versioned!
        </td>
        <td style="border: solid thin black; color: black; text-align: left; background:#ffbbbb;" valign="top">
        &middot; Not letting me see it<br />
        &middot; Unnormalized<br />
        &middot; Dumb names<br />
        &middot; Incorrect types<br />
        &middot; String-based keys<br />
        &middot; No constraints<br />
        &middot; Undocumented
        </td>
    </tr>
</table>
</p>
<p>
What else am I missing?
</p>
</div>
  
  


    </article>
  
  
    <article>
      <header>
  
    <h1 class="entry-title"><a href="/blog/2008/09/26/are-you-emailing-yourself-your-log-errors-you-should-be.html">Are you emailing yourself your log errors?  You should be.</a></h1>
  
  
    <p class="meta">
      








  



<time datetime="2008-09-26T00:00:00-04:00" pubdate data-updated="true"></time>
    </p>
  
</header>

  <div><p>
Time and time again, users complain about an application crashing on them or otherwise not working.  They don't provide you any info and it's hard to repeat.  You check out the log, but there's thousands (or millions) of entries and you have no clue where their error occured.  Worse, if you are deploying a RIA, the log  may be on their computer and not available.
</p>
<p>
On my last project we experienced this scenario so much that we instituted two things
<ul>
<li>All messages logged with <tt>Level.ERROR</tt> in log4j would be emailed to us</li>
<li>All exceptions caught on the client would be packaged and sent back to the server and logged at <tt>Level.ERROR</tt> level (thus emailing them to us</li>
</ul>
After the initial deluge of emails, we <b>found a lot of bugs</b>.  I mean <b>a lot</b> of bugs.  The annoying, intermittent kind that are hard to reproduce.  Further, by judicious use of logging, we discovered a lot of mis-configured environments and other problems without having to get users to mail us their logs.
</p>
<p>At <a href="http://www.gliffy.com">Gliffy</a>, they are doing the same thing.  Right now, we're testing a bunch of new features and the stage instance just sent me a bunch of emails, all indicating configuration problems, which is the exact kind of thing that can be hard to track down.
</p>
<p>
Setting it up using log4j is dead simple:
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">log4j</span><span class="o">.</span><span class="na">appender</span><span class="o">.</span><span class="na">mail</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">log4j</span><span class="o">.</span><span class="na">net</span><span class="o">.</span><span class="na">SMTPAuthenticateAppender</span>
<span class="n">log4j</span><span class="o">.</span><span class="na">appender</span><span class="o">.</span><span class="na">mail</span><span class="o">.</span><span class="na">SMTPHost</span><span class="o">=</span><span class="nd">@SMTP_HOST</span><span class="err">@</span>
<span class="n">log4j</span><span class="o">.</span><span class="na">appender</span><span class="o">.</span><span class="na">mail</span><span class="o">.</span><span class="na">UserName</span><span class="o">=</span><span class="nd">@SMTP_USER</span><span class="err">@</span>
<span class="n">log4j</span><span class="o">.</span><span class="na">appender</span><span class="o">.</span><span class="na">mail</span><span class="o">.</span><span class="na">Password</span><span class="o">=</span><span class="nd">@SMTP_PASS</span><span class="err">@</span>
<span class="n">log4j</span><span class="o">.</span><span class="na">appender</span><span class="o">.</span><span class="na">mail</span><span class="o">.</span><span class="na">Authenticate</span><span class="o">=</span><span class="kc">true</span>
<span class="n">log4j</span><span class="o">.</span><span class="na">appender</span><span class="o">.</span><span class="na">mail</span><span class="o">.</span><span class="na">From</span><span class="o">=</span><span class="n">errors</span><span class="nd">@gliffy.com</span>
<span class="n">log4j</span><span class="o">.</span><span class="na">appender</span><span class="o">.</span><span class="na">mail</span><span class="o">.</span><span class="na">To</span><span class="o">=</span><span class="nd">@SMTP_LOGGER_FAILURE</span><span class="err">@</span>
<span class="n">log4j</span><span class="o">.</span><span class="na">appender</span><span class="o">.</span><span class="na">mail</span><span class="o">.</span><span class="na">Subject</span><span class="o">=</span><span class="n">Errors</span> <span class="n">from</span> <span class="nd">@SMTP_DESC</span><span class="err">@</span>
<span class="n">log4j</span><span class="o">.</span><span class="na">appender</span><span class="o">.</span><span class="na">mail</span><span class="o">.</span><span class="na">BufferSize</span><span class="o">=</span><span class="mi">1</span>
<span class="n">log4j</span><span class="o">.</span><span class="na">appender</span><span class="o">.</span><span class="na">mail</span><span class="o">.</span><span class="na">Threshold</span><span class="o">=</span><span class="n">ERROR</span>
<span class="n">log4j</span><span class="o">.</span><span class="na">appender</span><span class="o">.</span><span class="na">mail</span><span class="o">.</span><span class="na">LocationInfo</span><span class="o">=</span><span class="kc">true</span> 
<span class="n">log4j</span><span class="o">.</span><span class="na">appender</span><span class="o">.</span><span class="na">mail</span><span class="o">.</span><span class="na">layout</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">log4j</span><span class="o">.</span><span class="na">PatternLayout</span> 
<span class="n">log4j</span><span class="o">.</span><span class="na">appender</span><span class="o">.</span><span class="na">mail</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">ConversionPattern</span><span class="o">=%</span><span class="n">d</span> <span class="o">%</span><span class="n">p</span><span class="o">%</span><span class="n">n</span><span class="o">%</span><span class="n">t</span><span class="o">%</span><span class="n">n</span><span class="o">%</span><span class="nl">c:</span><span class="o">%</span><span class="nl">M:</span><span class="o">%</span><span class="n">L</span><span class="o">%</span><span class="n">n</span><span class="o">---%</span><span class="n">n</span><span class="o">%</span><span class="n">m</span><span class="o">%</span><span class="n">n</span><span class="o">---%</span><span class="n">n</span><span class="o">%</span><span class="n">n</span></code></pre></div>

In my previous job I even created a customized layout to format the emails in such a way that our code was highlighted and GMail didn't compress things into threads.
</p>
<p>
If you aren't doing this, you should be.  Now.
</p>
</div>
  
  


    </article>
  
  
    <article>
      <header>
  
    <h1 class="entry-title"><a href="/blog/2008/09/17/getting-rakes-packagetask-to-depend-on-generated-files.html">Getting Rake's PackageTask to depend on generated files</a></h1>
  
  
    <p class="meta">
      








  



<time datetime="2008-09-17T00:00:00-04:00" pubdate data-updated="true"></time>
    </p>
  
</header>

  <div>Been playing with <a href="http://rake.rubyforge.org/">Rake</a> lately and decided to use it to package up the PHP Client Library for the <a href="http://www.gliffy.com">Gliffy</a> <a href="http://jira.gliffy.com/browse/GLIFFY-775">integration API</a>.  Didn't seem to make sense to use ant for something that amounts to creating a tarball.  <tt>make</tt> would be appropriate here, too, but I figured it would be cool to use Rake and there's not really much harm in doing so.

A large annoyance is <tt>Rake::PackageTask</tt>.  This is a seemingly handy task that creates tars, zips, etc. and is pretty useful.  It's not a task in and of itself, but it creates the <tt>:package</tt> task:

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Rake</span><span class="o">::</span><span class="no">PackageTask</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;gliffy-php-client&quot;</span><span class="p">,</span><span class="no">GLIFFY_VERSION</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span>
    <span class="nb">p</span><span class="o">.</span><span class="n">need_tar</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="nb">p</span><span class="o">.</span><span class="n">need_zip</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="nb">p</span><span class="o">.</span><span class="n">package_files</span> <span class="o">=</span> <span class="no">SRC_FILES</span> <span class="o">+</span> <span class="no">EXAMPLE_FILES</span> <span class="o">+</span> <span class="no">DOC_FILES</span>
<span class="k">end</span></code></pre></div>

Unfortunately, this doesn't do what it seems to do.  <tt>DOC_FILES</tt> is the list of documentation files output by <a href="http://www.phpdoc.org/">phpDocumentor</a> and are not checked into version control.  The syntax of the <tt>PackageTask</tt> makes it appear that the code in the block will run when the <tt>:package</tt> task executes, however this is not the case.  This code is initialization code.  So, I tried:
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># DOC_DIR is the dir generated by phpdoc, a task elsewhere</span>
<span class="c1"># uses this to kick off phpdoc</span>
<span class="n">task</span> <span class="ss">:package</span> <span class="o">=&gt;</span> <span class="no">DOC_DIR</span></code></pre></div>

The result is that the tarball and zip files are created and <b>then</b> the documentation is generated.  The reason is that <tt>PackageTask.new</tt> creates a set of tasks and the actual creation of the tarball/zip file is done via a <tt>file</tt> task, upon which <tt>:package</tt> is dependent.  So, the real dependency I created was:
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">task</span> <span class="ss">:package</span> <span class="o">=&gt;</span> <span class="s2">&quot;gliffy-php-client.zip&quot;</span> <span class="s2">&quot;gliffy-php-client.tgz&quot;</span> <span class="no">DOC_DIR</span></code></pre></div>

Examining the source code, a task named for the directory created by <tt>:package</tt> is created.  This task is dependent on the <tt>package_files</tt> set up in the constructor.  So <b>this</b> is the task I need to use:
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Have to keep a reference to the PackageTask object</span>
<span class="n">package_task</span> <span class="o">=</span> <span class="no">Rake</span><span class="o">::</span><span class="no">PackageTask</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;gliffy-php-client&quot;</span><span class="p">,</span><span class="no">GLIFFY_VERSION</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span>
    <span class="nb">p</span><span class="o">.</span><span class="n">need_tar</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="nb">p</span><span class="o">.</span><span class="n">need_zip</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="c1"># Executed BEFORE any other tasks; DOC_FILES don&#39;t exist  yet</span>
    <span class="nb">p</span><span class="o">.</span><span class="n">package_files</span> <span class="o">=</span> <span class="no">SRC_FILES</span> <span class="o">+</span> <span class="no">EXAMPLE_FILES</span>
<span class="k">end</span>

<span class="n">file</span> <span class="n">package_task</span><span class="o">.</span><span class="n">package_dir_path</span> <span class="o">=&gt;</span> <span class="no">DOC_DIR</span>

<span class="n">file</span> <span class="no">DOC_DIR</span> <span class="o">=&gt;</span> <span class="no">SRC_FILES</span> <span class="o">+</span> <span class="no">EXAMPLE_FILES</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
    <span class="nb">system</span><span class="p">(</span><span class="s2">&quot;phpdoc </span><span class="si">#{</span><span class="no">PHP_DOC_ARGS</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="n">doc_files</span> <span class="o">=</span> <span class="no">FileList</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">DOC_DIR</span> <span class="o">+</span> <span class="s2">&quot;/**/**&quot;</span><span class="p">);</span>
    <span class="c1"># Have to add these files to the package_task file list</span>
    <span class="n">package_task</span><span class="o">.</span><span class="n">package_files</span> <span class="o">=</span> <span class="n">package_task</span><span class="o">.</span><span class="n">package_files</span> <span class="o">+</span> <span class="n">doc_files</span>
<span class="k">end</span></code></pre></div>

This is definitely a hack, because I'm depending on the internal implementation of the <tt>PackageTask</tt>.  It really needs a facility for including generated files.  In <tt>make</tt>, I could just send the directory <tt>DOC_DIR</tt> to <tt>tar</tt> and it would pick up everything.  In Ant, I'd probably have to spawn another ant, since ant sets all property vaules at startup time.
</div>
  
  


    </article>
  
  
    <article>
      <header>
  
    <h1 class="entry-title"><a href="/blog/2008/09/17/better-open-source-hosting-sourceforge-is-looking-weak.html">Better open-source hosting: SourceForge is looking weak</a></h1>
  
  
    <p class="meta">
      








  



<time datetime="2008-09-17T00:00:00-04:00" pubdate data-updated="true"></time>
    </p>
  
</header>

  <div><p>I currently host <a href="http://vimdoclet.sf.net">my Vim Javadoc doclet</a> on <a href="http://www.sourceforge.net">SourceForge</a> and <b>every</b> time I have to deal with it, it's just a monumental pain.  The documentation is insanely long and detailed, the website looks horribly out of date and cruddy, and when compared to stuff like <a href="http://www.github.com">GitHub</a> and <a href="http://www.lighthouseapp.com">Lighthouse</a>, it's almost embarrassing how difficult it is to deal with and how bad the UI is (despite my best efforts, it <b>still</b> insists that the featured download is the vimdoc samples and not the doclet itself.  WTF?).
</p>
<p>
I'm already hosting the code in GitHub and just moved my tickets to Lighthouse.  The only thing left is where to host binary downloads and static assets.  For <a href="http://www.googlecode.com/p/restunit">RESTUnit</a>, I'm using <a href="http://code.google.com">Google Code</a>, which is pretty easy to deal with (about a zillion times simpler and easier than SourceForge), however it has no facility for hosting arbitrary HTML.  Currently, I'm just using my website for static assets.
</p>
<p>
While I do like the new Web-2.0 way of doing things (one site like GitHub really focusing on source, another like Lighthouse just does ticketing, etc. and they integrate via web services), I'm not sure where the best place is to host downloads and static assets.  I would need programmatic access and some liberal download/diskspace quotas for sure.  It would also be nice to be able to connect to other services, for example generate a changelog based on commits or tickets closed since the last release.
</p>
</div>
  
  


    </article>
  
  
    <article>
      <header>
  
    <h1 class="entry-title"><a href="/blog/2008/09/12/test-rest-services.html">Test REST Services</a></h1>
  
  
    <p class="meta">
      








  



<time datetime="2008-09-12T00:00:00-04:00" pubdate data-updated="true"></time>
    </p>
  
</header>

  <div><p>In my reply to <a href="http://www.tbray.org/ongoing/When/200x/2008/09/10/Misusing-RSpec">a post on Tim Bray's blog</a> about using RSpec for testing REST services, I briefly described a project I'm working on, based on the work I've been doing at <a href="http://www.gliffy.com">Gliffy</a>, which is a testing framework for REST services called, unsurprisingly, <a href="http://code.google.com/p/restunit/">RestUNIT</a>.
</p>
<p>
For Gliffy's REST-based <a href="http://jira.gliffy.com/browse/GLIFFY-775">integration API</a>, I needed a way to test it, and hand-coding test cases using <a href="http://hc.apache.org/httpclient-3.x/">HTTPClient</a> was just not going to cut it.  Further, requests to Gliffy's API require signing (similar to how Flickr does it), and our API was going to support multiple ways of specifying the representation type as well as tunneling over POST.
</p>
<p>
So, it occured to me that there was a lazier way of doing this testing.  All I really needed to specify was the relative URL, parameters, headers, method, and expected response.  Someone else could do the signing and re-run the tests with the various options (such as specifying the MIME Type via the <tt>Accept:</tt> header, and then again via a file extension in the URL).</p>
<p>
I ended up creating a bunch of text files with this information.  I then used a Ruby script to generate two things:  an XML file that could be deserialized into a java object useful for testing, and a PHP script to test our PHP client API.
</p>
<p>
The Ruby script would also do things like calculate the signature (the test text files contained the api and secret keys a Gliffy user would have to use the API) and generate some derivative tests (e.g. one using a <tt>DELETE</tt>, and another tunneling that over <tt>POST</tt>).  The testing engine could generate some additional derivative tests (e.g. GET requests should respond to conditional gets if the server sent back an <tt>ETag</tt> or <tt>Last-Modified</tt> header).  All this then runs as a <a href="http://testng.org">TestNG</a> test.  
</p>
<p>
The whole thing works well, but is pretty hackish.  So, RestUNIT was created as a fresh codebase to create a more stable and useful testing engine.  My hope is to specify tests as YAML or some other human-readable markup, instead of XML (which is essentially binary for any real-sized data) and to allow for more sophisticated means of comparing results, deriving tests, and running outside a container (all the Gliffy tests require a specific data set and run in-container).
</p>
<p>
</p>
The test specification format should then be usable to generate tests in any other language (like I did with PHP).  I'm working on this slowly in my spare time and trying to keep the code clean and the architecture extensible, but not overly complex.
</p>
</div>
  
  


    </article>
  
  
    <article>
      <header>
  
    <h1 class="entry-title"><a href="/blog/2008/09/11/schema-for-rest-services.html">Schema for REST services</a></h1>
  
  
    <p class="meta">
      








  



<time datetime="2008-09-11T00:00:00-04:00" pubdate data-updated="true"></time>
    </p>
  
</header>

  <div><p>
I'm currently working the <a href="http://jira.gliffy.com/browse/GLIFFY-775">integration API</a> for <a href="//www.gliffy.com">Gliffy</a>, which is a REST-based service.  The API is fairly stable and we're readying a few ancillary things for release.  One of those is the documentation for the API.  I found it quite difficult to completely describe the REST services and ultimately  ended up creating something that lists out "objects" and "methods", even though the API is not really object-based.  For example, the object "Diagram" has a "method" called "list"; to "call" it, you do an HTTP <tt>GET</tt> to <tt>accounts/<i>your account name</i>/diagrams</tt>. 
</p>
<p>The original spec I created to work against (and thus, our initial draft of API documentation) was basically a list of URLs and the HTTP methods they responded to.  Not very easy to navigate or understand on a first sitting.  Some sort of schema to describe the REST API would have been really helpful (along the lines of an XML Schema).  Such a schema could facilitate documentation, testing, code generation.
</p>
<p>
As an example, consider some features of the Gliffy API: you can list the users in an account, list the diagrams in an account and reference an individual diagram via id.  Here's a YAML-esque description of these services:
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">&lt;b&gt;accounts:&lt;/b&gt;</span>
  <span class="l-Scalar-Plain">&lt;b&gt;kind:&lt;/b&gt; literal</span>
  <span class="l-Scalar-Plain">&lt;b&gt;desc:&lt;/b&gt; &lt;i&gt;&quot;Reference to all accounts&quot;&lt;/i&gt;</span>
  <span class="l-Scalar-Plain">&lt;b&gt;POST:&lt;/b&gt;</span>
    <span class="l-Scalar-Plain">&lt;b&gt;desc:&lt;/b&gt; &lt;i&gt;&quot;Creates a new account&quot;&lt;/i&gt;</span>
    <span class="l-Scalar-Plain">&lt;b&gt;parameters:&lt;/b&gt;</span>
        <span class="l-Scalar-Plain">- account_name</span>
            <span class="l-Scalar-Plain">&lt;b&gt;required:&lt;/b&gt; true</span>
            <span class="l-Scalar-Plain">&lt;b&gt;desc:&lt;/b&gt; &lt;i&gt;&quot;Name of the account you want to create&quot;&lt;/i&gt;</span>
        <span class="l-Scalar-Plain">- admin_email</span>
            <span class="l-Scalar-Plain">&lt;b&gt;required:&lt;/b&gt; true</span>
            <span class="l-Scalar-Plain">&lt;b&gt;desc:&lt;/b&gt; &lt;i&gt;&quot;Email address of an administrator for the new account&quot;&lt;/i&gt;</span>
  <span class="l-Scalar-Plain">&lt;b&gt;children:&lt;/b&gt;</span>
     <span class="l-Scalar-Plain">&lt;b&gt;account_name:&lt;/b&gt;</span>
       <span class="l-Scalar-Plain">&lt;b&gt;kind:&lt;/b&gt; variable</span>
       <span class="l-Scalar-Plain">&lt;b&gt;desc:&lt;/b&gt; &lt;i&gt;&quot;The name of your account&quot;&lt;/i&gt;</span>
       <span class="l-Scalar-Plain">&lt;b&gt;GET:&lt;/b&gt;</span>
         <span class="l-Scalar-Plain">&lt;b&gt;desc:&lt;/b&gt; &lt;i&gt;&quot;Returns meta-data about the account&quot;&lt;/i&gt;</span>
         <span class="l-Scalar-Plain">&lt;b&gt;parameters:&lt;/b&gt;</span>
            <span class="l-Scalar-Plain">- show_users</span>
              <span class="l-Scalar-Plain">&lt;b&gt;required:&lt;/b&gt; false</span>
              <span class="l-Scalar-Plain">&lt;b&gt;desc:&lt;/b&gt; &lt;i&gt;&quot;If true, users are included, if false, they are not&quot;&lt;/i&gt;</span>
       <span class="l-Scalar-Plain">&lt;b&gt;children:&lt;/b&gt;</span>
         <span class="l-Scalar-Plain">&lt;b&gt;diagrams:&lt;/b&gt;</span>
           <span class="l-Scalar-Plain">&lt;b&gt;kind:&lt;/b&gt; literal</span>
           <span class="l-Scalar-Plain">&lt;b&gt;desc:&lt;/b&gt; &lt;i&gt;&quot;All diagrams in the account&quot;&lt;/i&gt;</span>
           <span class="l-Scalar-Plain">&lt;b&gt;POST:&lt;/b&gt;</span>
             <span class="l-Scalar-Plain">&lt;b&gt;desc:&lt;/b&gt; &lt;i&gt;&quot;Creates a new diagram&quot;&lt;/i&gt;</span>
             <span class="l-Scalar-Plain">&lt;b&gt;parameters:&lt;/b&gt;</span>
               <span class="l-Scalar-Plain">- diagram_name</span>
                 <span class="l-Scalar-Plain">&lt;b&gt;required:&lt;/b&gt; true</span>
                 <span class="l-Scalar-Plain">&lt;b&gt;desc:&lt;/b&gt; &lt;i&gt;&quot;Desired name for this diagram&quot;&lt;/i&gt;</span>
               <span class="l-Scalar-Plain">- template_id</span>
                 <span class="l-Scalar-Plain">&lt;b&gt;required:&lt;/b&gt; false</span>
                 <span class="l-Scalar-Plain">&lt;b&gt;type:&lt;/b&gt; numeric</span>
                 <span class="l-Scalar-Plain">&lt;b&gt;dsec:&lt;/b&gt; &lt;i&gt;&quot;If present, the id of the diagram to copy, instead of using the blank one&quot;&lt;/i&gt;</span>
           <span class="l-Scalar-Plain">&lt;b&gt;GET:&lt;/b&gt;</span>
             <span class="l-Scalar-Plain">&lt;b&gt;desc:&lt;/b&gt; &lt;i&gt;&quot;Gets a list of all diagrams in this account&quot;&lt;/i&gt;</span>
           <span class="l-Scalar-Plain">&lt;b&gt;children:&lt;/b&gt;</span>
             <span class="l-Scalar-Plain">&lt;b&gt;id:&lt;/b&gt;</span>
               <span class="l-Scalar-Plain">&lt;b&gt;kind:&lt;/b&gt; variable</span>
               <span class="l-Scalar-Plain">&lt;b&gt;type:&lt;/b&gt; numeric</span>
               <span class="l-Scalar-Plain">desc &lt;i&gt;&quot;The id of a particular diagram&quot;&lt;/i&gt;</span>
               <span class="l-Scalar-Plain">&lt;b&gt;GET:&lt;/b&gt;</span>
                 <span class="l-Scalar-Plain">&lt;b&gt;desc:&lt;/b&gt; &lt;i&gt;&quot;Gets the diagram; the requested encoding type will determine the form&quot;&lt;/i&gt;</span>
                 <span class="l-Scalar-Plain">&lt;b&gt;parameters:&lt;/b&gt;</span>
                   <span class="l-Scalar-Plain">- &lt;b&gt;version:&lt;/b&gt;</span> 
                     <span class="l-Scalar-Plain">&lt;b&gt;desc:&lt;/b&gt; &lt;i&gt;&quot;The version to get, 1 is the original version.  If omitted, current version is retrieved&quot;&lt;/i&gt;</span>
                     <span class="l-Scalar-Plain">&lt;b&gt;required:&lt;/b&gt; false</span>
                     <span class="l-Scalar-Plain">&lt;b&gt;type:&lt;/b&gt; numeric</span>
                   <span class="l-Scalar-Plain">- &lt;b&gt;size:&lt;/b&gt;</span>
                     <span class="l-Scalar-Plain">&lt;b&gt;desc:&lt;/b&gt; &quot;For rastered formats, determins the size</span>
                     <span class="l-Scalar-Plain">&lt;b&gt;type:&lt;/b&gt; enumeration</span>
                       <span class="l-Scalar-Plain">- L</span>
                       <span class="l-Scalar-Plain">- M</span>
                       <span class="l-Scalar-Plain">- S</span>
               <span class="l-Scalar-Plain">&lt;b&gt;DELETE:&lt;/b&gt;</span>
                 <span class="l-Scalar-Plain">&lt;b&gt;desc:&lt;/b&gt; &lt;i&gt;&quot;Deletes this image&quot;&lt;/i&gt;</span>
          <span class="l-Scalar-Plain">&lt;b&gt;users:&lt;/b&gt;</span>
            <span class="l-Scalar-Plain">&lt;b&gt;kind:&lt;/b&gt; literal</span>
            <span class="l-Scalar-Plain">&lt;b&gt;desc:&lt;/b&gt; &lt;i&gt;&quot;All users in the account&quot;&lt;/i&gt;</span>
            <span class="l-Scalar-Plain">&lt;b&gt;GET:&lt;/b&gt;</span>
              <span class="l-Scalar-Plain">&lt;b&gt;desc:&lt;/b&gt; &lt;i&gt;&quot;gets a list of all users in the account&quot;&lt;/i&gt;</span></code></pre></div>
Since "accounts" is the only top-level element, we are saying that every request to this service must start with <tt>accounts/</tt>.  It has one child, which is a variable value for the account name.  It is untyped, so any potential string is allowed.  <b>That element</b> has two possible children: <tt>diagrams</tt> and <tt>users</tt>.  <tt>diagrams</tt> indicates that it responds to the HTTP methods <tt>POST</tt> and <tt>GET</tt>.  A <tt>POST</tt> requires the parameter <tt>diagram_name</tt>, while the parameter <tt>version</tt> is optional.
</p>
<p>
A standard format like this could easily be used to generate documentation, expectations, test cases,  and even stub code.   This format could even be delivered by an <tt>OPTIONS</tt> call to a resource.  I realize there is not much standardization around how to design and implement a REST service, but something like this could at least be a stake in the ground and support a specific method.
</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="16">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="14">Newer &rarr;</a>
    
  </div>
</div>

</body></html>
